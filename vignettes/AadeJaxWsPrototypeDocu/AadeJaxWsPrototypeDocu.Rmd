---
output:
  pdf_document:
    includes:
      in_header: tex/header.tex
    fig_caption: false
  word_document: default
---

```{r DocumentSetup, echo=FALSE, results='hide', include=FALSE}
### # specify knitr options
knitr::opts_chunk$set(echo = FALSE, results = 'asis')
```
```{r EnumeratorSetup, echo=FALSE, results='hide'}
### # initialize section counter
robjSecEnum <- rqudocuhelper::SectionEnumerator$new()
```
```{r AbrTableSetup, echo=FALSE, results='hide'}
### # instantiate table of abbreviation
r6ob_abbrtable <- rmddochelper::R6ClassTableAbbrev$new()
```


![Qualitas Logo](png/QualitasLogo.png)

\fcolorbox{black}{white}{
	\parbox[t]{1.0\linewidth}{
		\centering \fontsize{12pt}{20pt}\selectfont % 
		\vspace*{0.5cm} % 

		\hfill Umsetzungsdokumentation

		\vspace*{0.5cm} 
	}
}

\vspace*{0.5cm}

\fcolorbox{black}{white}{
	\parbox[t]{1.0\linewidth}{
		\centering \fontsize{25pt}{40pt}\selectfont %
		\vspace*{0.7cm}
    Automated Animal Data Exchange    \\
    Jax Webservice Prototyp    \\
    ATDA-ASR    \\

		\vspace*{0.7cm} % Space between the end of the title and the bottom of the grey box
	}
}

\vspace*{1cm}

\begin{center}
\includegraphics[width=0.5\textwidth]{png/Pedigree.png}
\end{center}

\vspace{5ex}
{\centering \small
\hfill
\begin{tabular}{l}
Peter von Rohr                      \\
FB EDV, Qualitas AG                 \\
Chamerstrasse 56, CH-6300 Zug       \\
\verb+http://www.qualitasag.ch+     \\
\verb+peter.vonrohr@qualitasag.ch+  
\end{tabular}
}

\pagebreak

\tableofcontents

\pagebreak

```{r DocuStatusTable}
r6objDocStat <- rmddochelper::R6ClassDocuStatus$new()

# r6objDocStat$set_current_status(psVersion = "0.0.901",
#                                  psStatus  = "Erstellung",
#                                  psProject = "ATDA-ASR",
#                                 psDate = "2016-07-25")
# r6objDocStat$set_current_status(psVersion = "0.0.902",
#                                  psStatus  = "Maven Projekte",
#                                  psProject = "ATDA-ASR",
#                                 psDate = "2016-07-28")
# r6objDocStat$set_current_status(psVersion = "0.0.903",
#                                  psStatus  = "Erstellen WSDL Datei",
#                                  psProject = "ATDA-ASR",
#                                 psDate = "2016-07-28")

r6objDocStat$set_current_status(psVersion = "0.0.904",
                                 psStatus  = "Webservice basierend auf WSDL",
                                 psProject = "ATDA-ASR",
                                psDate = "2016-08-02")
r6objDocStat$include_doc_stat(psTitle = "## Dokumentenstatus")
```

\pagebreak


## Erklärung
Dieses Dokument protokolliert die Schritte zur Erstellung eines `r r6ob_abbrtable$add_abbrev(psAbbrev = "JAX-WS", psMeaning = "Java XML Webservice")`. Im Projekt `r r6ob_abbrtable$add_abbrev(psAbbrev = "ATDA-ASR", psMeaning = "Automatisierter Tierdatenaustausch der ASR")` stellt sich bei der geplanten Zusammenarbeit mit `r r6ob_abbrtable$add_abbrev(psAbbrev = "CRV", psMeaning = "Cooperative Cattle Improvement")` zur Entwicklung von PlugIns für den Export von Milchmengendaten ab `r r6ob_abbrtable$add_abbrev(psAbbrev = "ISM", psMeaning = "Informationssysteme der Melkanlagen")` die Fragestellung nach der Implementierung eines Systems basierend auf Spezifikationen, welche als `r r6ob_abbrtable$add_abbrev(psAbbrev = "WSDL", psMeaning = "Webservice Description Language")` und `r r6ob_abbrtable$add_abbrev(psAbbrev = "XSD", psMeaning = "XML Service Description")` Dateien gegeben sind. Mit der Implementierung ist hier gemeint, dass wir die WSDL- und die XSD-Dateien als Input verwenden, um das Grundgerüst des Programmcodes zu erzeugen. Dieses Grundgerüst wird im Wesentlichen aus Definitionen von Klassen und Methoden bestehen.

Eine Suche nach mögliche Werkzeugen zur Unterstützung bei der Implementierung einer bestehenden Schema-Definition führte auf das Maven-Plugin `Apache CXF`. Als Voraussetzung wurde zuerst einmal Maven und das Ecliplse-Plug-in M2Eclipse installiert.


## Einführung
Der Datentransfer im Projekt ATDA-ASR ist in drei Abschnitten geplant. 

1. Export der Milchmengendaten aus dem ISM mit Hilfe von PlugIn`s
2. Transfer der exportierten Milchmengendaten vom ISM zur Datenbank
3. Import der transferierten Daten in ARGUS

In den Abschnitten 1 und 2 wäre eine Zusammenarbeit mit CRV für uns sehr wertvoll. Insbesondere die Verwendung der PlugIns auf den ISM auf den Betrieben würde unser Projekt sehr beschleunigen. Die ISM auf den Betrieben sind Hersteller-spezifisch und müssen darum an die technischen Besonderheiten der Hersteller angepasst werden. Eine eigene Entwicklung dieser PlugIns würde den Aufwand im Projekt ATDA-ASR sehr stark erhöhen. 

Gemäss `r r6ob_abbrtable$add_abbrev(psAbbrev = "BvL", psMeaning = "Bert vant Land")` von CRV ist im Herbst 2016 ein Projekt zur Entwicklung eines generischen APIs für die Betriebs-PlugIns geplant. Dieses Projekt soll auf den Vorgaben des Projekts 
`r r6ob_abbrtable$add_abbrev(psAbbrev = "ICAR-ADE", psMeaning = "ICAR Animal Data Exchange")`
`r r6ob_abbrtable$add_abbrev(psAbbrev = "ICAR", psMeaning = "International Committee for Animal Recording", pbQuote = FALSE, pbOut = FALSE)`
 basieren. Diese Vorgaben bestehen aus einer Projektspezifikation und aus WSDL- und XSD-Dateien. Somit bekommt die automatische Code-Generierung basieren auf WSDL- und XSD-Dateien eine bestimmte Wichtigkeit.


## Konfiguration des Applikationsservers in Eclipse
Sobald in Eclipse ein neuer Workspace erzeugt wird, muss die Konfiguration des Applikationsservers neu erstellt werden. Als Voraussetzung für diese Einstellung muss der gewünschte Applikationsserver zuerst installiert sein. Die folgenden Schritte zeigen die Einstellung am Beispiel von TomEE (siehe auch im Abschnitt "Configuration of the Eclipse Workspace" auf http://help.eclipse.org). Folgende Schritte führen zur gewünschten Konfiguration

1. In Eclipse wähle das Menu __File > New > Other ...__
2. Selektiere __Server > Server__
3. Click __Next__

```{r EclipseTomEESetup}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "EclipseTomEESetup")
```


## Maven Projekt
Maven ist ein Projektmanagementtool (https://maven.apache.org). Dieses kann als stand-alone Variante eingesetzt werden. Alternativ dazu existiert das PlugIn M2Eclipse (http://www.eclipse.org/m2e/), welches Maven Support für Eclipse bietet. Die Dokumentation unter http://www.eclipse.org/m2e/ ist nicht sehr ausführlich. Es gibt aber genügend andere Einführungen, wie ein Maven-Projekt in Eclipse gestartet werden kann. Als Bespiel verwenden wir hier eine Anleitung von [Tech-Recipes](http://www.tech-recipes.com/) unter http://www.tech-recipes.com/rx/39279/create-a-new-maven-project-in-eclipse. 

### Voraussetzung
Bevor M2Eclipse verwendet werden kann, muss das PlugIn installiert werden. Dies kann über die PlugIn-Installations-Funktionalität in Eclipse gemacht werden. Als erstes Fügen wir eine neue Download-Site hinzu. 

```{r InstallM2E}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "InstallM2E", pnPaperWidthScale = 0.6)
```

Die Installation in Eclipse wird gestartet über "Help" > "Install New Software"

```{r HelpInstallM2E}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "HelpInstallM2E", pnPaperWidthScale = 0.6)
```

### Erstes Maven Projekt
Die Anleitung unter http://www.tech-recipes.com/rx/39279/create-a-new-maven-project-in-eclipse zeigt, wie ein einfaches Maven-Projekt erstellt wird. In Eclipse wird mit "File" > "New" > "Other" der Maven-Wizard ausgewählt und darin angegeben, dass ein neues "Maven-Projekt" erstellt werden soll.

```{r EclipseMavenWizard}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "EclipseMavenWizard", pnPaperWidthScale = 0.6)
```

Als erstes wählen wir die Option "Create a simple project". Dies macht eine gewisse Auswahl an Vorlagen (sogenannte Archätypen).

```{r SimpleMavenProject}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "SimpleMavenProject", pnPaperWidthScale = 0.6)
```

Danach müssen gewisse Informationen zum Projekt spezifiziert werden. Diese Informationen sind im Eingabefenster mit Namen versehen, welche für den Anfänger nicht auf Anhieb selbsterklärend sind. Als erstes wird eine "GroupId" verlangt. Die entspricht offenbar dem Namen der Institution in der typischen Java-Klassen-Nomenklatur, welche in etwa einem verkehrten URL entspricht. Im Feld "Artifact Id" soll der Name des Projekts eingetragen werden. Die übrigen Felder sind selbsterklärend. Der Abschnitt unter "Parent Project" kann leer gelassen werden.

```{r ConfigureMavenProject}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "ConfigureMavenProject", pnPaperWidthScale = 0.6)
```

Als Resultat wurde ein neues Projekt in Eclipse erzeugt. Dieses enthält eine vorgegebene Struktur, welche auf dem folgenden Screenshot ersichtlich ist. Java code soll unter "src/main/java" abgelegt werden. Resourcen platziert man in "src/main/resources". Tests werden unter "src/test" angelegt.

```{r NewProjectInExplorer}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "NewProjectInExplorer", pnPaperWidthScale = 0.6)
```

The file "pom.xml" contains the information that was entered into the configuration window before. This file can be seen in different views using the different tabs at the bottom of the window.

```{r PomXml}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "PomXml", pnPaperWidthScale = 0.6)
```

### Weiterführendes Maven Projekt
Die im vorangegangenen Unterabschnitt beschriebene Vorgehensweise beschreibt nur die Erstellung eines einfachen Mavenprojektes. In diesem Projekt gibt es aber noch keinen Code und auch keinen Test. Das gleiche Vorgehen, mit Ausnahme, dass kein einfaches sondern ein auf Archätypen basiertes Projekt erzeugt wird, ist unter https://wiki.jasig.org/display/UPM32/Creating+a+Simple+Maven+Project beschrieben. Diese Beschreibung wird hier nicht weiter erläutert werden. 

Unter http://crunchify.com/how-to-create-dynamic-web-project-using-maven-in-eclipse wird ein dynamisches Web-Projekt mit Maven in Eclipse erstellt. Diese Anleitung soll hier im Detail analysiert werden. Die Erstellung des Maven-Projekts läuft gleich bis zur Angabe des Archätypen. Dort wird die Artifact-Id "maven-archetype-webapp" ausgewählt.

```{r MavenArchWebApp}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "MavenArchWebApp", pnPaperWidthScale = 0.6)
```

In der erzeugten Webapplikation erscheint der unten gezeigte Fehler.

```{r ServletSuperclassNotFound}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "ServletSuperclassNotFound", pnPaperWidthScale = 0.6)
```

Dieser Fehler kann behoben werden durch die Angabe der Abhängigkeit im pom.xml oder durch das Hinzufügen von Apache Tomcat als Runtime. Das Projekt kann nun gebuildet werden mit "Rechts-Klick" auf das Projekt und dann "Run As" > "Maven build ...". Die drei Punkte scheinen wichtig und führen im Gegensatz zur ersten "Maven build"-Option im Menufeld dazu, dass ein weiteres Optionsfenster geöffnet wird.

```{r RunAsMavenBuild}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "RunAsMavenBuild", pnPaperWidthScale = 0.6)
```

Im folgenden Screenshot sind die zusätzlichen Optionen angegeben.

```{r MavenBuildConfig}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "MavenBuildConfig", pnPaperWidthScale = 0.6)
```

In der Console von Eclipse sollte als Resultat "BUILD SUCCESS" stehen (siehe roten Pfeil)

```{r MavenBuildResult}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "MavenBuildResult", pnPaperWidthScale = 0.6)
```

Sobald die Applikation der Building-Prozess abgeschlossen ist kann sie auf den Applikationsserver deployed werden. Dies kann über einen Rechts-Klick im Server-Tab auf dem entsprechenden Applikationsserver gemacht werden. Im Menufenster wählt man dann "Add and Remove" aus und verschiebt die Applikation so auf den Server.

```{r DeployWebApp}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "DeployWebApp", pnPaperWidthScale = 0.6)
```

Der Webservice kann nun über http://localhost:8080/AaDeMavenTutorial/index.jsp im Browser aufgrufen werden.

```{r WebAppInBrowser}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "WebAppInBrowser", pnPaperWidthScale = 0.6)
```


## Erzeugung einer WSDL-Musterdatei
Gemäss der Anleitung unter http://crunchify.com/create-sample-wsdl-in-eclipse-and-generate-client kann in Eclipse eine WSDL-Datei erzeugt werden. In einem weiteren Abschnitt kann die erzeugte Datei dann getestet werden.


### Schritt 1: Ein Java Project
Die Erstellung eines Java-Projekts in Eclipse ist abhängig von der Ansicht in welcher man sich gerade befindet. In der Java EE-Ansicht sind die Java-Projekte unter "New" > "Other" verfügbar. In der Java SE-Ansicht gibt es den direkten Pfad über "File" > "New" > "Java Project". Sobald dieses Projekt angelegt wird, wechselt Eclipse in die Java SE-Anicht. 

```{r NewJavaProject}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "NewJavaProject")
```


### Schritt 2: WSDL Datei
Mit "File" > "New" > "Other" > "Web Services" > "WSDL" wird eine neue WSDL-Datei erzeugt.


### Schritt 3: Zuweisung der WSDL Datei zum Projekt
Die neu erzeugte WSDL-Datei kann einem Projekt zugewiesen werden. Hier weisen wir die Datei dem unter Schritt 1 erzeugten Java Projekt zu.

```{r NewWSDLFile}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "NewWSDLFile")
```


### Schritt 4 und 5: Anpassungen bei Konfiguration


### Schritt 6: Generierung des Clients
Auf der WSDL-Datei einen Rechts-Click und dann "Web Services" > "Generate Client" auswählen.


### Schritt 7: Test client
Mit dem Schieber auf "Test client" und dann "Finish". Dies erzeugt den Client und macht einen Test.

```{r TestClient}
rmddochelper::insertOdgAsPdf(psOdgFileStem = "TestClient")
```


## Ein SOAP-basierter Web Service
Da das Projekt `ICAR-ADE` auf SOAP basiert und die von CRV in Aussicht gestellten PlugIns auf der Spezifikation von `ICAR-ADE` basieren soll, versuchen wir hier als erstes einen einfachen SOAP-basierten Webservice zu erstellen.


### Apache Axis2
Etlichen Tests einen einfachen SOAP basierten Webservice in Eclipse zu erstellen und dann auf TomEE (v7) unter Verwendung des Projektframeworks `Apache Axis2` zu installieren, haben gezeigt, dass dies offenbar nicht funktioniert. `Apache Axis2` scheint offenbar nicht mit Version 3.0 von Dynamic Web Projects in Eclipse kompatibel zu sein. 


### Apache CXF
Als Alternative zu Axis2 steht CXF zur Verfügung. Ob die Verwendung von CXF zu einem lauffähigen Webservice führt muss noch getestet werden.


### Maven Webapp
Wie oben beschrieben, kann ein einfacher Webservice auch über die Erstellung eines Maven-Projekts erstellt werden. 

<!-- END of document:  Below this must not be anything, except the command to write all abbreviations to a file --> 
```{r WriteTableOfAbbreviations, results='hide'}
if (!r6ob_abbrtable$is_empty_abbr())
  r6ob_abbrtable$writeToTsvFile()
```

\pagebreak

```{r AbrTableToDocument}
r6ob_abbrtable$include_abbr_table(psAbbrTitle = "## Abkürzungen")
```









